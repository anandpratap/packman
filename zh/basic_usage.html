---
layout: default
title: 基本用法
category: zh
tags: doc
---

<h1><a name="安装软件">安装软件</a></h1>
<div class="notice">
  最近一次更新对PACKMAN有较大幅度改变，因此在使用上可能会发觉不同。
</div>
<p>
 	安装并配置好PACKMAN后就可以安装需要的软件了，如安装NetCDF软件包：
<pre>
$ packman install netcdf
</pre>
 	该命令将安装NetCDF的三种语言接口（C、C++和Fortran），以及NetCDF的依赖包（如HDF5）。命令执行完后，NetCDF会被安装在之前所指定的<code>install_root</code>下，并按照一定规则存放，例如：
<pre>
$ ls <font color="red">&lt;install_root&gt;</font>/netcdf_c/4.3.3.1/0/
<font color="lightblue">bin include lib</font> packman.info <font color="lightblue">share</font>
$ ls <font color="red">&lt;install_root&gt;</font>/netcdf_cxx/4.2.1/0/
<font color="lightblue">bin include lib</font> packman.info
$ ls <font color="red">&lt;install_root&gt;</font>/netcdf_fortran/4.4.2/0/
<font color="lightblue">bin include lib</font> packman.info
</pre>
  不同版本、使用不同编译器集合编译的软件包会被分开存放，而不是混在一起。另外，可以看到这三种语言接口被安装到了不同目录，不过这并不会导致使用不便，因为他们都被链接到了同一个目录<code>&lt;install_root&gt;/0</code>，因此当有需要时只要使用该目录即可。
</p>
<p>
  为了解决之前安装软件后需要重新登录的问题，当前活跃的编译器集合（由配置文件中的<code>defaults compiler_set_index</code>指定）所安装的软件目录（如<code>&lt;install_root&gt;/1</code>）会再次被链接到<code>&lt;install_root&gt;/packman.active</code>，并且该目录已经被加载到环境变量中。
</p>

<h1><a name="查看安装选项">查看安装选项</a></h1>
<p>
	软件包有时会包含一些安装选项供用户控制，可以通过如下命令查看：
<pre>
$ packman report -package_options netcdf
[<font color="green">Notice</font>]: Options of package <font color="green">Netcdf</font>:
<font color="blue">skip_test</font>: <font color="purple">false</font>
<font color="blue">compiler_set_indices</font>: <font color="purple">[]</font>
<font color="blue">use_binary</font>: <font color="purple">false</font>
<font color="blue">use_version</font>: <font color="purple">string</font>
<font color="blue">use_mpi</font>: <font color="purple">package_name or boolean</font>
<font color="blue">with_cxx</font>: <font color="purple">true</font>
<font color="blue">with_fortran</font>: <font color="purple">true</font>
</pre>
	这里可以看到有7个选项可供设置。比如可以选择不安装C++接口：
<pre>
$ packman install netcdf -with_cxx=false
</pre>
	<div class="notice">
		命令行指定的选项默认会应用于所有涉及到的软件包（如依赖包），有时候这样做并不合适，如使用<code>use_version</code>来选定软件版本，对于依赖包肯定是不对的，所以PACKMAN引入<code>+</code>选项，使得该选项只作用于命令行指定的软件包，如：
<pre>
$ packman install cdo +use_version='1.6.3'
</pre>
	</div>
</p>

<h1><a name="切换软件版本">切换软件版本</a></h1>
<p>
  	为了使新安装的软件生效，你需要在你的<code>~/.bashrc</code>文件中添加一行：
<pre>
source <font color="red">&lt;install_root&gt;</font>/packman.bashrc
</pre>
  	使得环境变量生效。需要注意的是<code>&lt;install_root&gt;/packman.bashrc</code>中包含的是用默认编译器集合安装的软件，如果需要使用其它编译器集合编译的软件可以通过如下命令生成一个bashrc文件：
<pre>
$ packman switch -compiler_set_index=<font color="red">&lt;编译器集合编号&gt;</font> -output=<font color="red">&lt;bashrc文件名或目录&gt;</font>
</pre>
  	然后source该文件即可（如果<code>-output</code>给的是一个目录，那么会在该目录下生成一个<code>packman.bashrc</code>文件）。
</p>

<h1><a name="搭建FTP镜像">搭建FTP镜像</a></h1>
<p>
    是的，没错！搭建FTP镜像是一个非常简单的操作，任何电脑都可以为其它电脑提供下载软件包的中转服务（即镜像），因为有些时候下载某些包十分耗时，或者其它电脑或服务器不方便连接互联网。首先，初始化镜像服务：
    <div class="notice">
        <b>注意</b>：<code>&lt;package_root&gt;</code>及其上级目录必须具有正确的权限！否则你会遇到：
<pre>
530-unable to set anonymous privileges error resolving</pre>
    </div>
<pre>
$ packman mirror -init
[<font color="green">Notice</font>]: Package <font color="green">Proftpd</font> has been installed.
[<font color="green">Notice</font>]: Use port 2121 for FTP mirror service.
[<font color="green">Notice</font>]: Download all defined packages.
...
</pre>
    所有被定义的软件包及其附件都被下载到<code>&lt;package_root&gt;</code>目录下。然后可以打开镜像服务
<pre>
$ packman mirror -start
</pre>
    之后可以查看FTP服务是否开启
<pre>
$ packman mirror -status
</pre>
    当需要关闭FTP服务时，执行以下命令
<pre>
$ packman mirror -stop
</pre>
    <div class="notice">
        开启和关闭镜像服务需要root权限，因为需要打开FTP服务。
    </div>
</p>
